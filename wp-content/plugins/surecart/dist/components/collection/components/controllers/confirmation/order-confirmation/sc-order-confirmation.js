import apiFetch from"../../../../functions/fetch";import{h}from"@stencil/core";import{__}from"@wordpress/i18n";import{addQueryArgs,getQueryArg}from"@wordpress/url";import{Universe}from"stencil-wormhole";export class ScOrderConfirmation{constructor(){this.order=void 0,this.loading=!1,this.error=void 0}componentWillLoad(){Universe.create(this,this.state()),this.getSession()}getSessionId(){var e;return(null===(e=this.order)||void 0===e?void 0:e.id)?this.order.id:getQueryArg(window.location.href,"sc_order")}async getSession(){var e;if(this.getSessionId()&&!(null===(e=this.order)||void 0===e?void 0:e.id))try{this.loading=!0,this.order=await await apiFetch({path:addQueryArgs(`surecart/v1/checkouts/${this.getSessionId()}`,{expand:["line_items","line_item.price","line_item.fees","price.product","customer","customer.shipping_address","payment_intent","discount","manual_payment_method","discount.promotion","billing_address","shipping_address"],refresh_status:!0,currency_conversion:!1})})}catch(e){(null==e?void 0:e.message)?this.error=e.message:this.error=__("Something went wrong","surecart")}finally{this.loading=!1}}state(){var e,r;const t=null===(e=this.order)||void 0===e?void 0:e.manual_payment_method;return{processor:"stripe",loading:this.loading,orderId:this.getSessionId(),order:this.order,customer:null===(r=this.order)||void 0===r?void 0:r.customer,manualPaymentTitle:null==t?void 0:t.name,manualPaymentInstructions:null==t?void 0:t.instructions}}renderOnHold(){var e,r,t;return"processing"!==(null===(e=this.order)||void 0===e?void 0:e.status)?null:"paypal"===(null===(t=null===(r=null==this?void 0:this.order)||void 0===r?void 0:r.payment_intent)||void 0===t?void 0:t.processor_type)?h("sc-alert",{type:"warning",open:!0},__("Paypal is taking a closer look at this payment. Itâ€™s required for some payments and normally takes up to 3 business days.","surecart")):void 0}renderManualInstructions(){var e;const r=null===(e=this.order)||void 0===e?void 0:e.manual_payment_method;if(null==r?void 0:r.instructions)return h("sc-alert",{type:"info",open:!0},h("span",{slot:"title"},null==r?void 0:r.name),h("div",{innerHTML:null==r?void 0:r.instructions}))}render(){var e,r;return h(Universe.Provider,{key:"0ec0bf6375a8d2984afd140641ff7aa0b08d2d6b",state:this.state()},h("div",{key:"50ec95cac58659680f4c8d61125e038356fb4de3",class:{"order-confirmation":!0}},h("div",{key:"d857726a6d2674249d45a90a48af954ecaf1a75d",class:{"order-confirmation__content":!0,hidden:!(null===(e=this.order)||void 0===e?void 0:e.id)&&!this.loading}},h("sc-order-confirm-components-validator",{key:"ebaf4a3b890961683c7d1796487b331bc66f12af",checkout:this.order},h("slot",{key:"ce3115033f66d85a3b50eea57bd77d918c36dd0e"}))),!(null===(r=this.order)||void 0===r?void 0:r.id)&&!this.loading&&h("sc-heading",{key:"dd906afd44fcca32c8415fa93d78aa8be39f0454"},__("Order not found.","surecart"),h("span",{key:"3f09d15923ae8b46a9accf76bd39ce99420c1313",slot:"description"},__("This order could not be found. Please try again.","surecart")))))}static get is(){return"sc-order-confirmation"}static get encapsulation(){return"shadow"}static get originalStyleUrls(){return{$:["sc-order-confirmation.css"]}}static get styleUrls(){return{$:["sc-order-confirmation.css"]}}static get properties(){return{order:{type:"unknown",mutable:!0,complexType:{original:"Checkout",resolved:"Checkout",references:{Checkout:{location:"import",path:"../../../../types",id:"src/types.ts::Checkout"}}},required:!1,optional:!1,docs:{tags:[],text:""}}}}static get states(){return{loading:{},error:{}}}}