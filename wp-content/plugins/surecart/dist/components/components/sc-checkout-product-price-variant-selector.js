import{proxyCustomElement,HTMLElement,h,Fragment}from"@stencil/core/internal/client";import{g as getLineItemByProductId}from"./getters2.js";import{s as state,o as onChange}from"./mutations2.js";import{g as getVariantFromValues}from"./util.js";import{u as updateLineItem,a as addLineItem}from"./index4.js";import{u as updateFormState}from"./mutations5.js";import{c as createErrorNotice}from"./mutations3.js";import{i as isProductVariantOptionSoldOut,a as isProductVariantOptionMissing}from"./utils.js";import{d as defineCustomElement$8}from"./sc-choice-container2.js";import{d as defineCustomElement$7}from"./sc-choices2.js";import{d as defineCustomElement$6}from"./sc-form-control2.js";import{d as defineCustomElement$5}from"./sc-pill-option2.js";import{d as defineCustomElement$4}from"./sc-price-choice-container2.js";import{d as defineCustomElement$3}from"./sc-skeleton2.js";import{d as defineCustomElement$2}from"./sc-visually-hidden2.js";const scCheckoutProductPriceVariantSelectorCss="sc-checkout-product-price-variant-selector{display:block}.sc-form-label{font-family:var(--sc-font-sans);font-size:var(--sc-font-size-medium);font-weight:var(--sc-font-weight-normal);margin-bottom:var(--sc-input-label-margin);display:inline-block;color:var(--sc-input-label-color);font-weight:var(--sc-input-label-font-weight);text-transform:var(--sc-input-label-text-transform, none);letter-spacing:var(--sc-input-label-letter-spacing, 0)}.sc-form-select{--sc-form-select-bg-img:url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23374151' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e\");display:block;width:100%;padding:0 var(--sc-input-spacing-medium);height:calc(var(--sc-input-height-medium) - var(--sc-input-border-width) * 2);font-size:var(--sc-input-font-size-medium);font-family:var(--sc-input-font-family);font-weight:var(--sc-input-font-weight);color:var(--sc-color-gray-700);box-sizing:border-box;background-color:var(--sc-input-background-color);background-image:var(--sc-form-select-bg-img), var(--sc-form-select-bg-icon, none);background-repeat:no-repeat;background-position:right calc(var(--sc-input-spacing-medium) - 2px) center;background-size:16px 12px;border:var(--sc-input-border-width) solid var(--sc-input-border-color);border-radius:var(--sc-border-radius-medium);box-shadow:var(--sc-input-box-shadow);transition:var(--sc-input-transition, var(--sc-transition-medium)) color, var(--sc-input-transition, var(--sc-transition-medium)) border, var(--sc-input-transition, var(--sc-transition-medium)) box-shadow;appearance:none}.sc-form-select:hover{color:var(--sc-input-color-hover);background-color:var(--sc-input-background-color-hover);border-color:var(--sc-input-border-color-hover);z-index:7}.sc-form-select:focus{color:var(--sc-input-color-focus);background-color:var(--sc-input-background-color-focus) !important;border-color:var(--sc-input-border-color-focus) !important;outline:0;box-shadow:0 0 0 var(--sc-focus-ring-width) var(--sc-focus-ring-color-primary)}.sc-form-select[multiple],.sc-form-select[size]:not([size=\"1\"]){padding-right:var(--sc-input-spacing-medium);background-image:none}.sc-form-select:disabled{color:var(--sc-input-color-disabled);background-color:var(--sc-input-background-color-disabled);border-color:var(--sc-input-border-color-disabled)}.sc-form-select:-moz-focusring{color:transparent;text-shadow:0 0 0 var(--sc-input-color)}.form-select-sm{padding-top:var(--sc-input-spacing-small);padding-bottom:var(--sc-input-spacing-small);padding-left:var(--sc-input-spacing-small);font-size:var(--sc-input-font-size-small);border-radius:var(--sc-border-radius-small)}.form-select-lg{padding-top:var(--sc-input-spacing-large);padding-bottom:var(--sc-input-spacing-large);padding-left:var(--sc-input-spacing-large);font-size:var(--sc-input-font-size-large);border-radius:var(--sc-border-radius-large)}.sc-checkout-product-price-variant-selector{position:relative}.sc-checkout-product-price-variant-selector>*:not(:last-child){display:block;margin-bottom:var(--sc-form-row-spacing, 0.75em)}.sc-checkout-product-price-variant-selector__pills-wrapper{display:flex;flex-wrap:wrap;gap:var(--sc-spacing-x-small)}.sc-checkout-product-price-variant-selector__hidden-input{position:absolute !important;top:0 !important;left:0 !important;opacity:0 !important;padding:0px !important;margin:0px !important;pointer-events:none !important;width:0 !important}",ScCheckoutProductPriceVariantSelectorStyle0=scCheckoutProductPriceVariantSelectorCss,ScProductCheckoutSelectVariantOption=proxyCustomElement(class extends HTMLElement{constructor(){super(),this.__registerHost(),this.product=void 0,this.label=void 0,this.selectorTitle=void 0,this.selectedVariant=void 0,this.selectedPrice=void 0,this.option1=void 0,this.option2=void 0,this.option3=void 0}handleOptionChange(){var t,i;this.selectedVariant=getVariantFromValues({variants:null===(i=null===(t=this.product)||void 0===t?void 0:t.variants)||void 0===i?void 0:i.data,values:{...this.option1?{option_1:this.option1}:{},...this.option2?{option_2:this.option2}:{},...this.option3?{option_3:this.option3}:{}}})}isSelectedVariantOutOfStock(){var t,i;return(null===(t=this.product)||void 0===t?void 0:t.stock_enabled)&&this.hasVariants()&&!(null===(i=this.product)||void 0===i?void 0:i.allow_out_of_stock_purchases)&&this.selectedVariant.available_stock<1}hasRequiredSelectedVariant(){var t;return!this.hasVariants()||(null===(t=this.selectedVariant)||void 0===t?void 0:t.id)}async reportValidity(){return this.input.setCustomValidity(""),this.hasVariants()?this.hasRequiredSelectedVariant()?this.isSelectedVariantOutOfStock()?(this.input.setCustomValidity(wp.i18n.__("This selection is not available.","surecart")),this.input.reportValidity()):this.input.reportValidity():(this.input.setCustomValidity(wp.i18n.__("Please choose an available option.","surecart")),this.input.reportValidity()):this.input.reportValidity()}getSelectedPrice(){var t,i,e,o,n;return 1===(null===(e=null===(i=null===(t=this.product)||void 0===t?void 0:t.prices)||void 0===i?void 0:i.data)||void 0===e?void 0:e.length)?null===(n=null===(o=this.product)||void 0===o?void 0:o.prices)||void 0===n?void 0:n.data[0]:this.selectedPrice}async updateLineItems(){var t,i,e,o,n;const r=this.getSelectedPrice();if(!(null==r?void 0:r.id))return;const s=this.lineItem();if(((null===(t=null==s?void 0:s.price)||void 0===t?void 0:t.id)!==(null==r?void 0:r.id)||(null===(i=null==s?void 0:s.variant)||void 0===i?void 0:i.id)!==(null===(e=this.selectedVariant)||void 0===e?void 0:e.id))&&this.hasRequiredSelectedVariant()&&!this.isSelectedVariantOutOfStock())try{updateFormState("FETCH"),(null==s?void 0:s.id)?state.checkout=await updateLineItem({id:null==s?void 0:s.id,data:{variant:null===(o=this.selectedVariant)||void 0===o?void 0:o.id,price:null==r?void 0:r.id,quantity:1}}):state.checkout=await addLineItem({checkout:state.checkout,data:{variant:null===(n=this.selectedVariant)||void 0===n?void 0:n.id,price:null==r?void 0:r.id,quantity:1}}),updateFormState("RESOLVE")}catch(t){console.error(t),createErrorNotice(t),updateFormState("REJECT")}}componentWillLoad(){this.removeListener=onChange("checkout",(()=>{var t,i,e;const o=this.lineItem();this.selectedVariant=null==o?void 0:o.variant,this.selectedPrice=null==o?void 0:o.price,this.option1=null===(t=null==o?void 0:o.variant)||void 0===t?void 0:t.option_1,this.option2=null===(i=null==o?void 0:o.variant)||void 0===i?void 0:i.option_2,this.option3=null===(e=null==o?void 0:o.variant)||void 0===e?void 0:e.option_3}))}disconnectedCallback(){this.removeListener()}lineItem(){var t;return getLineItemByProductId(null===(t=this.product)||void 0===t?void 0:t.id)}hasVariants(){var t,i,e;return(null===(e=null===(i=null===(t=this.product)||void 0===t?void 0:t.variants)||void 0===i?void 0:i.data)||void 0===e?void 0:e.length)>0}isProductInCheckout(){var t,i;return((null===(i=null===(t=state.checkout)||void 0===t?void 0:t.line_items)||void 0===i?void 0:i.data)||[]).some((t=>{var i,e,o;return(null===(e=null===(i=t.price)||void 0===i?void 0:i.product)||void 0===e?void 0:e.id)===(null===(o=this.product)||void 0===o?void 0:o.id)}))}renderDropdown({name:t,values:i,index:e}){return this.isProductInCheckout()?h("div",{class:"sc-select-option__wrapper"},h("label",{class:"sc-form-label"},t),h("select",{class:"sc-form-select",onChange:t=>this[`option${e+1}`]=t.target.value},i.map((t=>{const i=isProductVariantOptionSoldOut.apply(void 0,[e+1,t,{...this.option1?{option_1:this.option1}:{},...this.option2?{option_2:this.option2}:{},...this.option3?{option_3:this.option3}:{}},this.product])||isProductVariantOptionMissing.apply(void 0,[e+1,t,{...this.option1?{option_1:this.option1}:{},...this.option2?{option_2:this.option2}:{},...this.option3?{option_3:this.option3}:{}},this.product]);return h("option",{value:t,selected:this[`option${e+1}`]===t},t," ",i&&h(Fragment,null," ",wp.i18n.__("(unavailable)","surecart")))})))):null}renderPills({name:t,values:i,index:e}){return this.isProductInCheckout()?h("sc-form-control",{label:t},h("div",{class:"sc-checkout-product-price-variant-selector__pills-wrapper"},(i||[]).map((i=>{const o=[e+1,i,{...this.option1?{option_1:this.option1}:{},...this.option2?{option_2:this.option2}:{},...this.option3?{option_3:this.option3}:{}},this.product],n=isProductVariantOptionSoldOut.apply(void 0,o)||isProductVariantOptionMissing.apply(void 0,o);return h("sc-pill-option",{isUnavailable:n,isSelected:this[`option${e+1}`]===i,onClick:()=>this[`option${e+1}`]=i},h("span",{"aria-hidden":"true"},i),h("sc-visually-hidden",null,wp.i18n.sprintf(wp.i18n.__("Select %s: %s","surecart"),t,i),n&&h(Fragment,null," ",wp.i18n.__("(option unavailable)","surecart"))))})))):null}render(){var t,i,e,o,n;return h("sc-form-control",{key:"461b978789aa5d4cbedf2a73e751690fce87a686",class:"sc-checkout-product-price-variant-selector",label:this.selectorTitle},(this.product.variant_options.data||[]).map((({name:t,values:i,display_type:e},o)=>"dropdown"===e?this.renderDropdown({name:t,values:i,index:o}):this.renderPills({name:t,values:i,index:o}))),(null===(e=null===(i=null===(t=this.product)||void 0===t?void 0:t.prices)||void 0===i?void 0:i.data)||void 0===e?void 0:e.length)>1&&h("sc-form-control",{key:"710dacae832e154690c7a29c0badb450a0b4552a",label:(null===(o=this.product.variant_options.data)||void 0===o?void 0:o.length)?this.label:null},h("sc-choices",{key:"bae8821a607043516f2c572f51689e0dad21aa37"},(this.product.prices.data||[]).sort(((t,i)=>(null==t?void 0:t.position)-(null==i?void 0:i.position))).map((t=>{var i,e,o;return h("sc-price-choice-container",{required:!0,price:t,label:(null==t?void 0:t.name)||(null===(i=this.product)||void 0===i?void 0:i.name),checked:(null===(o=null===(e=this.lineItem())||void 0===e?void 0:e.price)||void 0===o?void 0:o.id)===(null==t?void 0:t.id),onScChange:i=>{i.target.checked&&(this.selectedPrice=t)}})})))),h("input",{key:"2ce25324f8defdd723d576e21d87d2ecefbfafa1",class:"sc-checkout-product-price-variant-selector__hidden-input",ref:t=>this.input=t,value:null===(n=this.selectedVariant)||void 0===n?void 0:n.id}))}get el(){return this}static get watchers(){return{option1:["handleOptionChange"],option2:["handleOptionChange"],option3:["handleOptionChange"],selectedVariant:["updateLineItems"],selectedPrice:["updateLineItems"]}}static get style(){return ScCheckoutProductPriceVariantSelectorStyle0}},[0,"sc-checkout-product-price-variant-selector",{product:[16],label:[1],selectorTitle:[1,"selector-title"],selectedVariant:[32],selectedPrice:[32],option1:[32],option2:[32],option3:[32],reportValidity:[64]},void 0,{option1:["handleOptionChange"],option2:["handleOptionChange"],option3:["handleOptionChange"],selectedVariant:["updateLineItems"],selectedPrice:["updateLineItems"]}]);function defineCustomElement$1(){"undefined"!=typeof customElements&&["sc-checkout-product-price-variant-selector","sc-choice-container","sc-choices","sc-form-control","sc-pill-option","sc-price-choice-container","sc-skeleton","sc-visually-hidden"].forEach((t=>{switch(t){case"sc-checkout-product-price-variant-selector":customElements.get(t)||customElements.define(t,ScProductCheckoutSelectVariantOption);break;case"sc-choice-container":customElements.get(t)||defineCustomElement$8();break;case"sc-choices":customElements.get(t)||defineCustomElement$7();break;case"sc-form-control":customElements.get(t)||defineCustomElement$6();break;case"sc-pill-option":customElements.get(t)||defineCustomElement$5();break;case"sc-price-choice-container":customElements.get(t)||defineCustomElement$4();break;case"sc-skeleton":customElements.get(t)||defineCustomElement$3();break;case"sc-visually-hidden":customElements.get(t)||defineCustomElement$2()}}))}const ScCheckoutProductPriceVariantSelector=ScProductCheckoutSelectVariantOption,defineCustomElement=defineCustomElement$1;export{ScCheckoutProductPriceVariantSelector,defineCustomElement};